# Rate limiting per IP
SecAction \
    "id:2000,\
    phase:1,\
    nolog,\
    pass,\
    initcol:ip=%{REMOTE_ADDR},\
    setvar:ip.requests=0"

# Allow specific endpoints
SecRule REQUEST_URI "@beginsWith /api/user/profile/" \
    "id:2001,\
    phase:1,\
    allow,\
    ctl:ruleEngine=DetectionOnly"

# Protect file uploads
SecRule FILES_NAMES "@rx .*" \
    "id:2002,\
    phase:2,\
    pass,\
    setvar:'tx.allowed_file_extensions=jpg png jpeg gif webp'"