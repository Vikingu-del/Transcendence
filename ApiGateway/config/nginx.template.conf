worker_processes 1;

events { 
    worker_connections 1024; 
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen ${GATEWAY_PORT};  # NGINX listens on the port defined in env

        # Optional logging configuration
        access_log ${GATEWAY_ACCESS_LOG} ${GATEWAY_LOG_LEVEL};
        error_log ${GATEWAY_ERROR_LOG} ${GATEWAY_LOG_LEVEL};

        # Security headers
        add_header Content-Security-Policy ${GATEWAY_CSP_HEADER};

        client_max_body_size ${GATEWAY_CLIENT_MAX_BODY_SIZE};  # Set max client body size

        # Timeout settings
        proxy_read_timeout ${GATEWAY_PROXY_TIMEOUT};  # Set read timeout for the backend services

        location /auth/ {
            proxy_pass ${AUTHENTICATION_SERVICE_URL}/;  # Proxy to authentication service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /user/ {
            proxy_pass ${USER_SERVICE_URL}/;  # Proxy to user service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /game/ {
            proxy_pass ${GAME_SERVICE_URL}/;  # Proxy to game service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /chat/ {
            proxy_pass ${CHAT_SERVICE_URL}/;  # Proxy to chat service
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # You can add additional locations for other services as needed
    }
}
